<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FUOCO AMICO | FRIENDLYFIRE</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { --brand-red: #ff3a3a; --pixel-border: 4px solid #000; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; font-family: 'Press Start 2P', cursive; 
            touch-action: none; background: #2e4a1e;
        }

        #bg-layer {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: url('sfondo_pongo.PNG') repeat fixed; background-size: 450px;
            z-index: -1;
        }

        /* MANUTENZIONE */
        #maintenance-screen {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: #000; color: var(--brand-red); z-index: 999999;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; font-size: 15px;
        }

        /* HEADER & ICONS */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 25px; position: fixed; top: 0; left: 0; right: 0; 
            z-index: 10000; height: 100px;
        }
        .header-btn { width: 90px; height: 90px; object-fit: contain; cursor: pointer; transition: 0.2s; }

        /* GRID IPHONE STYLE */
        #main-slider {
            width: 300vw; height: 100vh; display: flex;
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .shop-page {
            width: 100vw; height: 100vh; display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, 1fr);
            padding: 110px 20px 160px 20px; box-sizing: border-box; gap: 15px;
        }

        .item-container { 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; position: relative; z-index: 600;
        }
        .item-container img { width: 90px; height: auto; pointer-events: none; }
        
        /* SCALA DI GRIGI PER ESAURIMENTO */
        .sold-out { filter: grayscale(1) !important; opacity: 0.5; pointer-events: none !important; }
        .sold-out::after { content: "SOLD OUT"; position: absolute; font-size: 6px; background: #000; color: #fff; top:0; padding: 2px; }

        .price-tag { font-size: 7px; margin-top: 5px; background: #000; color: #fff; padding: 4px; border: 2px solid #000; }

        /* BUTTONS PIXEL */
        .btn-pixel {
            background: #000; color: #fff; border: none; padding: 15px;
            font-family: 'Press Start 2P'; font-size: 10px;
            box-shadow: 5px 5px 0 var(--brand-red); cursor: pointer;
        }

        /* ADMIN & DB */
        .admin-box { background: #1a1a1a; color: #fff; overflow-y: auto; text-align: left; font-size: 7px; z-index: 1000000 !important; }
        .admin-entry { border-bottom: 1px solid #444; padding: 10px; display: flex; flex-wrap: wrap; gap: 5px; }
        input { background: #333; color: #fff; border: 1px solid #555; padding: 5px; font-family: 'Press Start 2P'; font-size: 6px; }

        #checkout-panel {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 25000; background: #fff; border: var(--pixel-border); padding: 25px;
            box-shadow: 12px 12px 0 #000; text-align: center;
        }

        @keyframes gnam { 0% { transform: scale(1); } 50% { transform: scale(2.5); } 100% { transform: scale(1); } }
        .masticando { animation: gnam 0.5s ease; }
    </style>
</head>
<body>

    <audio id="gnam-sound" src="suono_gnam.mp3" preload="auto"></audio>
    <div id="bg-layer"></div>

    <div id="maintenance-screen">
        <img src="fuochini_centrali.png" width="100"><br>
        FRIENDLYFIRE<br>UNDER MAINTENANCE<br><br>
        <span style="font-size: 8px;">DROP SOON...</span>
    </div>

    <header>
        <img src="mondo_pongo.PNG" class="header-btn" onclick="showPage('page-contatti')">
        <img src="fuochini_centrali.png" class="header-btn" id="master-logo">
        <img src="tank_header.PNG" class="header-btn" id="tank-cart">
    </header>

    <div id="main-slider">
        <div id="p1" class="shop-page"></div>
        <div id="p2" class="shop-page"></div>
        <div id="p3" class="shop-page"></div>
    </div>

    <div id="checkout-panel">
        <div style="font-size:10px; margin-bottom:15px;">CART</div>
        <div style="font-size:14px; margin-bottom:20px;">TOTAL: <span id="temp-total">0</span>€</div>
        <button class="btn-pixel" onclick="showCheckout()">CHECKOUT</button>
    </div>

    <div id="page-admin" class="overlay-page admin-box">
        <h2 style="color:var(--brand-red)">DATABASE CONFIG</h2>
        <div style="background:#333; padding:15px; margin-bottom:20px; border:2px solid #fff;">
            MANUTENZIONE: <button id="btn-maint" onclick="toggleMaint()" style="padding:10px; cursor:pointer;">OFF</button>
            <br><br>
            BG URL: <input type="text" id="admin-bg-url" placeholder="sfondo.png">
        </div>
        <div id="admin-items-list"></div>
        <button class="btn-pixel" onclick="addItem()" style="background:blue; width:100%; margin-bottom:5px;">+ AGGIUNGI ARTICOLO</button>
        <button class="btn-pixel" onclick="saveDatabase()" style="background:green; width:100%;">SALVA E PUBBLICA</button>
        <button class="btn-pixel" onclick="closePages()" style="background:#fff; color:#000; width:100%; margin-top:10px;">ESCI</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script>
        const gnam = document.getElementById('gnam-sound');
        const tank = document.getElementById('tank-cart');
        const slider = document.getElementById('main-slider');
        let isMaintenance = false;
        let cart = {};
        let itemsData = [
            { id: 0, name: 'CAP', price: 45, stock: 10, img: 'image_cap.PNG' },
            { id: 1, name: 'TEE', price: 65, stock: 0, img: 'image_tee.PNG' } // Esempio sold out
        ];

        function playGnam() { gnam.currentTime = 0; gnam.play().catch(()=>{}); }
        function showPage(id) { document.getElementById(id).style.display = 'flex'; playGnam(); }
        function closePages() { document.querySelectorAll('.overlay-page').forEach(p => p.style.display = 'none'); }

        function renderShop() {
            [1,2,3].forEach(p => document.getElementById(`p${p}`).innerHTML = '');
            itemsData.forEach((item, index) => {
                const pageNum = Math.floor(index / 12) + 1;
                if(pageNum > 3) return;
                const container = document.getElementById(`p${pageNum}`);
                
                // Applicazione scala di grigi se stock <= 0
                const soldClass = item.stock <= 0 ? 'sold-out' : '';
                
                container.innerHTML += `
                <div class="item-container ${soldClass}" id="item-${index}" data-index="${index}">
                    <img src="${item.img}">
                    <span class="price-tag">${item.price}€</span>
                </div>`;
            });
            initInteract();
        }

        function initInteract() {
            interact('.item-container:not(.sold-out)').draggable({
                listeners: {
                    move(event) {
                        const t = event.target;
                        const x = (parseFloat(t.getAttribute('data-x')) || 0) + event.dx;
                        const y = (parseFloat(t.getAttribute('data-y')) || 0) + event.dy;
                        t.style.transform = `translate(${x}px, ${y}px)`;
                        t.setAttribute('data-x', x); t.setAttribute('data-y', y);
                    },
                    end(event) {
                        event.target.style.transform = 'translate(0,0)';
                        event.target.setAttribute('data-x', 0);
                        event.target.setAttribute('data-y', 0);
                    }
                }
            });

            interact('#tank-cart').dropzone({
                accept: '.item-container:not(.sold-out)',
                ondrop: function(event) {
                    const idx = event.relatedTarget.getAttribute('data-index');
                    const item = itemsData[idx];
                    playGnam();
                    if(!cart[idx]) cart[idx] = {...item, qty: 1};
                    else cart[idx].qty++;
                    tank.classList.add('masticando');
                    setTimeout(() => tank.classList.remove('masticando'), 500);
                    updateUI();
                }
            });
        }

        function updateUI() {
            let total = 0; for(let k in cart) total += cart[k].price * cart[k].qty;
            document.getElementById('temp-total').innerText = total;
            document.getElementById('checkout-panel').style.display = total > 0 ? 'block' : 'none';
        }

        function toggleMaint() {
            isMaintenance = !isMaintenance;
            document.getElementById('btn-maint').innerText = isMaintenance ? 'ON' : 'OFF';
            document.getElementById('btn-maint').style.background = isMaintenance ? 'red' : 'grey';
        }

        function saveDatabase() {
            // Aggiorna dati da input admin
            itemsData.forEach((item, i) => {
                item.img = document.getElementById(`db-img-${i}`).value;
                item.price = parseInt(document.getElementById(`db-pr-${i}`).value);
                item.stock = parseInt(document.getElementById(`db-st-${i}`).value);
            });
            
            // Gestione Manutenzione
            document.getElementById('maintenance-screen').style.display = isMaintenance ? 'flex' : 'none';
            
            renderShop();
            closePages();
            alert("SITO AGGIORNATO!");
        }

        function openAdmin() {
            const list = document.getElementById('admin-items-list');
            list.innerHTML = '';
            itemsData.forEach((item, i) => {
                list.innerHTML += `
                <div class="admin-entry">
                    IMG: <input id="db-img-${i}" value="${item.img}" style="width:70px;">
                    €: <input id="db-pr-${i}" value="${item.price}" style="width:30px;">
                    STK: <input id="db-st-${i}" value="${item.stock}" style="width:25px;">
                    <button onclick="itemsData.splice(${i},1); openAdmin();" style="color:red;">X</button>
                </div>`;
            });
            showPage('page-admin');
        }

        function addItem() {
            itemsData.push({ id: Date.now(), name: 'NEW', price: 0, stock: 1, img: 'placeholder.png' });
            openAdmin();
        }

        // Trigger Admin (3 tocchi sui fuochi)
        let clicks = 0;
        document.getElementById('master-logo').addEventListener('click', () => {
            clicks++;
            if(clicks >= 3) {
                if(prompt("PASSWORD") === "FRIENDLYFIRE26") openAdmin();
                clicks = 0;
            }
        });

        renderShop();
    </script>
</body>
</html>
